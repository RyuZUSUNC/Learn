# RSA
http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html
http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html
## 非对称

- 乙方生成两把密钥（公钥和私钥）。公钥是公开的，任何人都可以获得，私钥则是保密的。

- 甲方获取乙方的公钥，然后用它对信息加密。

- 乙方得到加密后的信息，用私钥解密。

## 互质关系
如果两个正整数，除了1以外，没有其他公因子，我们就称这两个数是互质关系（coprime）。比如，15和32没有公因子，所以它们是互质关系。这说明，不是质数也可以构成互质关系。

1. 任意两个质数构成互质关系，比如13和61。
2. 一个数是质数，另一个数只要不是前者的倍数，两者就构成互质关系，比如3和10。
3. 如果两个数之中，较大的那个数是质数，则两者构成互质关系，比如97和57。
4. 1和任意一个自然数是都是互质关系，比如1和99。
5. p是大于1的整数，则p和p-1构成互质关系，比如57和56。
6. p是大于1的奇数，则p和p-2构成互质关系，比如17和15。

## 欧拉函数
任意给定正整数n，请问在小于等于n的正整数之中，有多少个与n构成互质关系？（比如，在1到8之中，有多少个数与8构成互质关系？）

计算这个值的方法就叫做欧拉函数，以φ(n)表示。在1到8之中，与8形成互质关系的是1、3、5、7，所以 φ(n) = 4。

推导略

## 欧拉定理

如果两个正整数a和n互质，则n的欧拉函数 φ(n) 可以让下面的等式成立：

$\alpha^{\phi(n)}\equiv1(mod\ n)$

也就是说 a 的φ(n)次方被n除的余数为1。或者说 a 的φ(n)次方减去1，可以被n整除。

比如，3和7互质，而7的欧拉函数φ(7)等于6，所以3的6次方(729)减去1，可以被7整除（728/7=104）

欧拉定理的证明比较复杂，这里就省略了。我们只要记住它的结论就行了。

欧拉定理可以大大简化某些运算。比如，7和10互质，根据欧拉定理

$7^{\phi(10)}\equiv1(mod\ 10)$

已知 φ(10) 等于4，所以马上得到7的4倍数次方的个位数肯定是1。

$7^{4k}\equiv1(mod\ 10)$

因此，7的任意次方的个位数（例如7的222次方），心算就可以算出来。

### 欧拉定理有一个特殊情况

假设正整数a与质数p互质，因为质数p的φ(p)等于p-1，则欧拉定理可以写成

$\alpha^{p-1}\equiv1(mod\ p)$

这就是著名的费马小定理。它是欧拉定理的特例。

欧拉定理是RSA算法的核心。理解了这个定理，就可以理解RSA。

## 模反元素

如果两个正整数a和n互质，那么一定可以找到整数b，使得 ab-1 被n整除，或者说ab被n除的余数是1。

$ab\equiv1(mod\ n)$

这时，b就叫做a的"模反元素"。

比如，3和11互质，那么3的模反元素就是4，因为 (3 × 4)-1 可以被11整除。显然，模反元素不止一个， 4加减11的整数倍都是3的模反元素 {...,-18,-7,4,15,26,...}，即如果b是a的模反元素，则 b+kn 都是a的模反元素。

欧拉定理可以用来证明模反元素必然存在。

$a^{\phi(n)}=a\times a^{\phi(n)-1}\equiv1(mod\ n)$

可以看到，a的 φ(n)-1 次方，就是a的模反元素。

## 密钥生成的步骤

1. 随机选择两个不相等的质数p和q。

    例如61，53

2. 计算p和q的乘积n。

    n = 61×53 = 3233

    n的长度就是密钥长度。3233写成二进制是110010100001，一共有12位，所以这个密钥就是12位。实际应用中，RSA密钥一般是1024位，重要场合则为2048位。

3. 计算n的欧拉函数φ(n)。根据如下公式得到为3120

   $\phi(n)=(p-1)(q-1)$

4. 随机选择一个整数e，条件是1< e < φ(n)，且e与φ(n) 互质。

    随机选个 17（实际应用中，常常选择65537。）

5. 计算e对于φ(n)的模反元素d。

所谓"模反元素"就是指有一个整数d，可以使得ed被φ(n)除的余数为1。

$ed\equiv1(mod\ \phi(n))$

这个式子等价于

$ed-1=k\phi(n)$

于是，找到模反元素d，实质上就是对下面这个二元一次方程求解。

$ex + \phi(n)y = 1$

已知 e=17, φ(n)=3120，

$17x + 3120y = 1$

6. 将n和e封装成公钥，n和d封装成私钥。

n=3233，e=17，d=2753，所以公钥就是 (3233,17)，私钥就是（3233, 2753）。

实际应用中，公钥和私钥的数据都采用ASN.1格式表达。

## RSA的可靠性
回顾上面的密钥生成步骤，一共出现六个数字：
```
　　p
　　q
　　n
　　φ(n)
　　e
　　d
```

这六个数字之中，公钥用到了两个（n和e），其余四个数字都是不公开的。其中最关键的是d，因为n和d组成了私钥，一旦d泄漏，就等于私钥泄漏。

那么，有无可能在已知n和e的情况下，推导出d？

```
　　（1）ed≡1 (mod φ(n))。只有知道e和φ(n)，才能算出d。

　　（2）φ(n)=(p-1)(q-1)。只有知道p和q，才能算出φ(n)。

　　（3）n=pq。只有将n因数分解，才能算出p和q。
```

结论：如果n可以被因数分解，d就可以算出，也就意味着私钥被破解。

wiki
>"对极大整数做因数分解的难度决定了RSA算法的可靠性。换言之，对一极大整数做因数分解愈困难，RSA算法愈可靠。
>
>假如有人找到一种快速因数分解的算法，那么RSA的可靠性就会极度下降。但找到这样的算法的可能性是非常小的。今天只有短的RSA密钥才可能被暴力破解。到2008年为止，世界上还没有任何可靠的攻击RSA算法的方式。
>
>只要密钥长度足够长，用RSA加密的信息实际上是不能被解破的。"

## 加密和解密

有了公钥和密钥，就能进行加密和解密了。

### 加密 使用公钥 (n,e)
如果要发送加密信息 m ,就要用公钥(n,e)对 m 进行加密。这里需要注意, m 必须是整数（字符串可以取ascii值或unicode值），且 m 必须小于 n。

所谓"加密"，就是算出下式的c：

$m^e \equiv c(mod\ n)$

公钥是 (3233, 17)，m 假设是65，那么可以算出下面的等式：

$65^{17}\equiv 2790(mod\ 3233)$

于是,c = 2790

### 解密 使用私钥 (n,d)

得到密文 c = 2790以后，就用私钥(3233, 2753)进行解密，可以证明下面等式一定成立

$c^d\equiv m(mod n)$

也就是说，c的d次方除以n的余数为m。现在，c等于2790，私钥是(3233, 2753),那么

$2790^2753\equiv 65(mod 3233)$

因此，爱丽丝知道了鲍勃加密前的原文就是65。

至此，"加密--解密"的整个过程全部完成。

我们可以看到，如果不知道d，就没有办法从c求出m。而前面已经说过，要知道d就必须分解n，这是极难做到的，所以RSA算法保证了通信安全。

你可能会问，公钥(n,e) 只能加密小于n的整数m，那么如果要加密大于n的整数，该怎么办？有两种解决方法：一种是把长信息分割成若干段短消息，每段分别加密；另一种是先选择一种"对称性加密算法"（比如DES），用这种算法的密钥加密信息，再用RSA公钥加密DES密钥。

## 总结
### 名称
- m: 明文
- c: 密文
- p,q: 随机选择的两个不相等的质数
- n: p与q的乘积
- φ(n): n的欧拉函数
- e: 随机选择的整数，条件是1< e < φ(n)，且e与φ(n) 互质。
- d: ed≡1(mod φ(n))
- 公钥:(n,e)
- 私钥:(n,d)